---
id: overview
title: 概述
slug: overview
order: 1
---

开发者每天的工作中，除了与 IDE 打交道外，另一个高频接触的就是 git、svn 这类代码版本管理系统。

通过代码版本管理系统，开发者在版本管理系统中保存代码，追踪源代码（或其他文件、文件夹）改动，管理代码的修改历史，并在必要时候通过回滚恢复早期版本。

- 管理开发。通过分支的提交、合并、回滚操作，开发者可以自由地进行更改，选择何时将变更发布，并能够在错误发生时执行回滚撤销错误的合并
- 追踪历史。版本管理系统的提交历史和对比功能，可以让开发者可以随时了解变更内容，追踪变更历史

除了源代码管理，很多需要进行配置变更的场景也都需要进行版本管理，管理配置变更、发布，追踪历史并执行回退操作。

部分企业建设的数据平台中就实现了**全链路化的版本管理**机制，实现了数据从采集同步，计算和使用各个环节的版本管理，提升开发者需求开发、发布体验，减少错误发生几率。

那么要如何实现 web 后台中的版本管理？如何在全链路中推行版本管理？

## DolphinScheduler 版本管理

文档链接：

- [Apache DolphinScheduler 版本控制核心原理揭秘](https://mp.weixin.qq.com/s/o-w1xeFbDZs5pRw3OvJV0Q)

版本管理主要是针对**增删改**三个场景，当发生变更操作时，在日志表中记录对应数据的版本。

- 新增操作。版本初始化为 0，在源表中插入数据后，同步插入到日志表。
- 修改操作。版本自增，在源表执行更新后，将源表更新后的数据同步插入到日志表。
- 删除操作。版本不做处理，在源表执行删除操作，日志表不做操作。

实现版本管理存储后，可以在 web 页面提供版本管理：

- 查看版本列表
- 版本回滚

因为 DolphinScheduler 使用关系型数据库作为工作流存储方案，对多张表创建了日志表后，变动如下：

- 表数量有所增加，表结构变更需要同时维护源表和日志表
- 日志表数据量激增。因为任何一次保存操作都会触发**增改**操作，导致日志表数据量增长很快

## gitops

Kubernetes 由谷歌开源的容器管理系统，管理数以千计的节点，抽象底层基础设施，提供资源调度、部署运行、服务发现、扩缩容等，通过 Kubernetes 用户可以方便地部署和管理容器化的应用。

### Kubernetes 声明式配置

Kubernetes 对象管理支持 3 种模式：

- 指令式命令
- 指令式对象配置
- 声明式对象配置

在声明式配置中，我们使用 YAML 来定义系统的终极状态，声明系统应该是什么样的，Kubernetes 自动化地根据 YAML 文件将集群推进到描述的状态。

在做自动化部署时，用户只需调整 YAML，Kubernetes 会处理现有对象的更新，匹配最新的状态。

### Kubernetes 资源

Kubernetes 中一切皆资源，一切皆对象。资源都可以通过 REST API 提交 JSON 或 YAML 格式文件创建，查看 Kubernetes 中的资源也都可以指定以 JSON 或 YAML 格式显示。

不同类型的资源具有各种属性，每个资源对象都有自己的特定结构，统一保存在 etcd 非关系型数据库中，实现高速读写。

资源对象一般都包含几个通用属性，专有的属性也会遵守特定的命名：

- 版本和资源类型。对应 `apiVersion` 和 `Kind`
- 元数据。对应 `metadata`，可以添加 name、namespace、annotations 和 labels
- spec。资源自定义
- status。资源自定义

spec 和 status 并非一定存在，也可以有其他属性比如 state，template 等等

### 版本化

声明性 YAML 文件可以直接使用代码版本管理系统进行版本控制，组织配置变更流程如提交、review、合并和回滚。

### 选择器

label（标签）是 Kubernetes 中的一个核心概念：

- 标签是 kv 结构，key 和 value 都由用户自己定义
- 标签可以被附加到各种资源对象上
- 资源对象可以被添加任意数量的标签
- 标签可以在资源对象创建时添加，也可以在创建后添加或删除

通过标签选择器，用户能方便地筛选出一组资源对象。
